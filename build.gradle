import de.undercouch.gradle.tasks.download.Download

plugins {
    id "de.undercouch.download" version "1.2"
    id "java"
}

def DOCKER_FOLDER = "res/docker"
def JASON_FOLDER = "jason-2.4"

// download zip
task downloadFile(type: Download) {
    // create directories
    file(DOCKER_FOLDER + "/" + JASON_FOLDER).mkdirs()

    src "https://deac-riga.dl.sourceforge.net/project/jason/jason/version%202.4/jason-2.4.zip"
    dest DOCKER_FOLDER
}

// unzip jason content
task unzip(type: Copy) {
    def zipFile = file(DOCKER_FOLDER + "/jason-2.4.zip")
    def outputDir = file(DOCKER_FOLDER + "/" + JASON_FOLDER)

    from zipTree(zipFile)
    into outputDir
}

// set repositories used
repositories {
    mavenCentral()
    maven {
        url "http://jacamo.sourceforge.net/maven2/"
    }
}

// define tasks dependencies
dependencies {
    implementation "org.jason-lang:jason:2.4"
}

// start agent specifying path, file and name
task start_agent(type: JavaExec) {
    if (!project.hasProperty("f")) {
        println "The agent name must be passed!"
        return
    }

    String path = project.property("p") ? project.property("p") : "."
    String file = project.property("f")
    String name = project.hasProperty("n") ? project.property("n") : file.substring(0, file.lastIndexOf('.'))

    group = "jason"

    classpath = sourceSets.main.runtimeClasspath
    standardInput = System.in
    main "jade.Boot"
    args "-container"
    args "$name:jason.infra.jade.JadeAgArch($path/$file)"
}